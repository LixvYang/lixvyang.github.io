import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as k,c as r,b as s,d as a,a as t,f as d,e,w as g}from"./app-a8507995.js";const v="/assets/images/program/zlog/zlog1.png",m="/assets/images/program/zlog/zlog2.png",q="/assets/images/program/zlog/zerolog_mixin_demo.jpg",b={},f={href:"https://github.com/rs/zerolog",target:"_blank",rel:"noopener noreferrer"},h={class:"hint-container tip"},w={href:"https://developers.mixin.one/",target:"_blank",rel:"noopener noreferrer"};function x(z,n){const o=p("ExternalLinkIcon"),c=p("HopeIcon"),u=p("BiliBili"),i=p("RouterLink");return k(),r("div",null,[s("p",null,[s("a",f,[n[0]||(n[0]=a("Zerolog")),t(o)]),n[1]||(n[1]=a("æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€é›¶åˆ†é…çš„Goæ—¥å¿—åº“ã€‚å®ƒåœ¨è®°å½•æ—¥å¿—çš„æ—¶å€™ä¸éœ€è¦åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦åƒåœ¾å›æ”¶ï¼Œå¯ä»¥ä»¥å®Œå…¨é›¶åˆ†é…çš„æ–¹å¼ä½¿ç”¨ã€‚"))]),d(" more "),s("p",null,[n[2]||(n[2]=a("æœ¬æ–‡ç« è§†é¢‘å·²ä¸Šä¼ è‡³Bç«™")),t(c,{icon:"fa6-brands:bilibili",color:"#23ADE5"}),n[3]||(n[3]=a("ğŸš€ğŸš€ğŸš€ :"))]),t(u,{bvid:"BV1T94y1h7SB"}),n[8]||(n[8]=e(`<h1 id="go-è¯­è¨€ä½¿ç”¨zerologæ—¥å¿—åº“" tabindex="-1"><a class="header-anchor" href="#go-è¯­è¨€ä½¿ç”¨zerologæ—¥å¿—åº“" aria-hidden="true">#</a> Go è¯­è¨€ä½¿ç”¨zerologæ—¥å¿—åº“</h1><h2 id="å®‰è£…" tabindex="-1"><a class="header-anchor" href="#å®‰è£…" aria-hidden="true">#</a> å®‰è£…</h2><p>zerologå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…åˆ°ä½ çš„Goé¡¹ç›®ä¸­:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">go</span> get <span class="token operator">-</span>u github<span class="token punctuation">.</span>com<span class="token operator">/</span>rs<span class="token operator">/</span>zerolog<span class="token operator">/</span>log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="å…¥é—¨" tabindex="-1"><a class="header-anchor" href="#å…¥é—¨" aria-hidden="true">#</a> å…¥é—¨</h2><p>è¯¥åº“æä¾›äº†ä¸€ä¸ªé¢„é…ç½®çš„å…¨å±€å¯ç”¨çš„è®°å½•å™¨ï¼Œä½ å¯ä»¥é€šè¿‡è½¯ä»¶åŒ…(zerolog/log)å¯¼å…¥å¹¶åœ¨å½“å‰é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/rs/zerolog/log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Zerolog&quot;</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥è‡ªå…¨å±€Zerologé…ç½®å™¨&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šç¨‹åºå¯ä»¥å°†JSONæ ¼å¼çš„æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T14:39:44+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Hello Zerolog&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T14:39:44+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;æ¥è‡ªå…¨å±€Zerologé…ç½®å™¨&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ—¥å¿—çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—çº§åˆ«" aria-hidden="true">#</a> æ—¥å¿—çº§åˆ«</h2><p>æ—¥å¿—çº§åˆ«æœ‰ä»¥ä¸‹å‡ ç§ï¼Œä¼˜å…ˆçº§é€æ¸æé«˜:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> Level <span class="token builtin">int8</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
    <span class="token comment">// TRACE ï¼ˆ-1ï¼‰ï¼šç”¨äºè·Ÿè¸ªä»£ç æ‰§è¡Œè·¯å¾„</span>
	TraceLevel Level <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token comment">// DEBUG ï¼ˆ0ï¼‰ï¼šå¯¹ç¨‹åºæ•…éšœæ’é™¤æœ‰ç”¨çš„æ¶ˆæ¯</span>
	DebugLevel Level <span class="token operator">=</span> <span class="token boolean">iota</span>
    <span class="token comment">// INFO ï¼ˆ1ï¼‰ï¼šæè¿°åº”ç”¨æ­£å¸¸è¿è¡Œçš„æ¶ˆæ¯</span>
	InfoLevel
    <span class="token comment">// WARNING ï¼ˆ2ï¼‰ï¼šç”¨äºè®°å½•å¯èƒ½éœ€è¦ç¨åæ£€æŸ¥çš„äº‹ä»¶</span>
	WarnLevel
    <span class="token comment">// ERROR ï¼ˆ3ï¼‰ï¼šç‰¹å®šæ“ä½œçš„é”™è¯¯æ¶ˆæ¯</span>
	ErrorLevel
    <span class="token comment">// FATAL ï¼ˆ4ï¼‰ï¼šåº”ç”¨ç¨‹åºæ— æ³•æ¢å¤çš„ä¸¥é‡é”™è¯¯ã€‚ os.Exit(1) åœ¨è®°å½•æ¶ˆæ¯åè°ƒç”¨</span>
	FatalLevel
    <span class="token comment">// PANIC ï¼ˆ5ï¼‰ï¼šä¸ ç±»ä¼¼ FATAL ï¼Œä½† panic() æ”¹ä¸ºè°ƒç”¨</span>
	PanicLevel
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¨å±€é…ç½®å™¨çš„æœ€ä½çº§åˆ«æ˜¯<code>Trace</code>ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡è°ƒç”¨<code>zerolog</code>åŒ…æä¾›çš„<code>SetGlobalLevel()</code>å‡½æ•°æ¥è®¾ç½®æ‰“å°æ—¥å¿—çš„æœ€ä½çº§åˆ«</p><p>å¦‚æœæˆ‘ä»¬è®¾ç½®æœ€ä½çº§åˆ«æ˜¯zerolog.ErrorLevel,é‚£ä¹ˆTraceã€Debugã€Infoã€Warnçº§åˆ«çš„æ—¥å¿—å°±ä¸ä¼šæ‰“å°äº†:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/rs/zerolog&quot;</span>
	<span class="token string">&quot;github.com/rs/zerolog/log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	zerolog<span class="token punctuation">.</span><span class="token function">SetGlobalLevel</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>ErrorLevel<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Zerolog&quot;</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥è‡ªå…¨å±€Zerologé…ç½®å™¨&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T14:44:52+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;æ¥è‡ªå…¨å±€Zerologé…ç½®å™¨&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="zerolog-api" tabindex="-1"><a class="header-anchor" href="#zerolog-api" aria-hidden="true">#</a> Zerolog API</h2><p>Zerologæä¾›äº†ä¸€ä¸ªç®€å•çš„ç»“æ„åŒ–çš„æ—¥å¿—è®°å½•APIï¼Œä»¥ä¾¿äºæˆ‘ä»¬ä½¿ç”¨ã€‚Loggerç±»å‹è¡¨ç¤ºå†™å…¥æŸä¸ª<code>io.Writer</code>ï¼Œå…¨å±€è®°å½•å™¨<code>zerolog/log</code>é»˜è®¤çš„æ¥å£ä¸º<code>os.Stderr</code>,ä½ å¯ä»¥ä½¿ç”¨<code>zerolog.New()</code>æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰çš„Loggerï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;os&quot;</span>

	<span class="token string">&quot;github.com/rs/zerolog&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;Hello new logger&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Hello new logger&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç±»ä¼¼çš„æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨åˆå§‹åŒ–æ—¶æŒ‡å®šå¯¹åº”çš„çº§åˆ«æ¥è®¾ç½®å¯æ‰“å°æ—¥å¿—çš„æœ€ä½çº§åˆ«,å¦‚æœæˆ‘ä»¬åˆå§‹åŒ–loggeræˆè¿™æ ·ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ‰“å°å¯¹åº”çš„ä¿¡æ¯äº†:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>	logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Level</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>InfoLevel<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="å°†æ—¥å¿—ä¸­åŠ ä¸Šå¯¹åº”ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#å°†æ—¥å¿—ä¸­åŠ ä¸Šå¯¹åº”ä¿¡æ¯" aria-hidden="true">#</a> å°†æ—¥å¿—ä¸­åŠ ä¸Šå¯¹åº”ä¿¡æ¯</h3><p>å½“æˆ‘ä»¬ä½¿ç”¨logåŠ ä¸Šå¯¹åº”çš„çº§åˆ«<code>Info()</code>ã€<code>Debug()</code>æ—¶ï¼Œè¿”å›çº§åˆ«å…¶å®æ˜¯<code>zerolog.Event</code>,Eventæä¾›äº†ä¸€äº›æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ä¿¡æ¯æ·»åŠ è¿›å…¥ä¸€äº›<code>é”®å€¼å¯¹</code>å¯¹ï¼Œä»¥ä¾¿æ—¥å¿—æ¡ç›®åŒ…å«è¶³å¤Ÿçš„æ•°æ®ã€‚æ¯”å¦‚ï¼Œåœ¨è®°å½•æœåŠ¡å™¨ä¸Šçš„èµ„æºåˆ›å»ºæ—¶ï¼Œå¯ä»¥åŒ…æ‹¬ç”¨æˆ·IDæˆ–å®¢æˆ·ç«¯ä¿¡æ¯ï¼ˆå¦‚ IP åœ°å€ï¼Œè®¾å¤‡ä¿¡æ¯ï¼‰ï¼Œä»¥ä¾¿ä»¥åé€šè¿‡æ­¤ç±»å±æ€§è½»æ¾è¿‡æ»¤æ—¥å¿—ã€‚ æ¯”å¦‚å½“æŸ¥è¯¢æ—¥å¿—æ—¶å¯ä»¥é€šè¿‡<code>grep</code>å‘½ä»¤å»è¿‡æ»¤ä¿¡æ¯ã€‚</p><p>è¯¥Eventç±»å‹çš„å¤§å¤šæ•°æ–¹æ³•éƒ½è¿”å›æŒ‡å‘çš„EventæŒ‡é’ˆï¼Œè¿™æ ·æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹æ–¹å¼å°†æ‰€æœ‰å¿…è¦çš„ä¸Šä¸‹æ–‡æ·»åŠ åˆ°Eventã€‚ä¹‹åæˆ‘ä»¬å¿…é¡»è°ƒç”¨<code>Msgf()</code>ã€<code>MsgFunc()</code>ã€<code>Send()</code>æ¥å®ŒæˆEventçš„æ‰“å°. é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨æ–¹æ³• Msg()ç”¨äºé€šè¿‡å‘æ—¥å¿—æ¡ç›®æ·»åŠ  message å­—æ®µæ¥å…³é—­Eventã€‚</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lixin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;login!&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;lixin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;login!&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœæƒ³è¦çœç•¥<code>message</code>å­—æ®µ,é‚£ä¹ˆå¯ä»¥é€šè¿‡<code>Msg(&quot;&quot;)</code>æˆ–è€…<code>Send()</code>:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lixin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>

logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lixin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;lixin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;lixin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">æ³¨æ„</p><p>è¯·æ³¨æ„ï¼Œå¿…é¡»åœ¨æœ€åè°ƒç”¨ä¸€ä¸ªäº‹ä»¶è°ƒç”¨å…³é—­æ–¹æ³•(Send/Msg/MsgFunc)ï¼Œ zerolog.Eventä»¥ä¾¿è®°å½•ç›¸åº”çš„æ¡ç›®ã€‚å¦‚æœæœªä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œåˆ™ä¸ä¼šè®°å½•æ—¥å¿—ã€‚</p></div><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lixin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºä¸ºç©º</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code></code></pre><div class="line-numbers" aria-hidden="true"></div></div><div class="hint-container warning"><p class="hint-container-title">æ³¨æ„</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œä¸€æ¬¡Eventï¼Œä¸€æ¬¡Msg/Sendï¼Œé˜²æ­¢å‡ºç°æ—¥å¿—æ„å¤–æƒ…å†µ:</p></div><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span>
	event <span class="token operator">:=</span> logger<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	event<span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">)</span>
	event<span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¹Ÿæ˜¯å‡½æ•°é“¾å¼ç¼–ç¨‹çš„å¥½å¤„ï¼Œå¦‚æœä½ å¯ä»¥ä½¿ç”¨é“¾å¼ç¼–ç¨‹ï¼Œé‚£ä¹ˆä¸Šè¿°çš„é—®é¢˜å°±ä¸ä¼šå‘ç”Ÿã€‚</p><h2 id="é…ç½®æ—¥å¿—è®°å½•å™¨çš„å…¨å±€ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ—¥å¿—è®°å½•å™¨çš„å…¨å±€ä¿¡æ¯" aria-hidden="true">#</a> é…ç½®æ—¥å¿—è®°å½•å™¨çš„å…¨å±€ä¿¡æ¯</h2><div class="hint-container info"><p class="hint-container-title">ç›¸å…³ä¿¡æ¯</p><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•ä½¿ç”¨ zerolog.Event ç±»å‹ä¸Šçš„æ–¹æ³•å‘æ—¥å¿—ä¸­æ·»åŠ ç›¸å…³å±æ€§ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬è¿™ä¸€éƒ¨åˆ†å°†æ›´è¿›ä¸€æ­¥ï¼Œå‘ä½ å±•ç¤ºå¦‚ä½•å°†å±æ€§æ•°æ®ä¿¡æ¯æ·»åŠ åˆ°è‡ªèº«Loggerï¼Œä»¥ç¡®ä¿æ­¤ç±»æ•°æ®åŒ…å«åœ¨å…¨å±€è®°å½•å™¨ç”Ÿæˆçš„æ‰€æœ‰åç»­æ—¥å¿—ä¸­ã€‚</p></div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿”å›Contextçš„With()æ–¹æ³•ã€‚å¯ä»¥è®©æˆ‘ä»¬é€šè¿‡ç±»ä¼¼äº zerolog.Event ç±»å‹ä¸Šçš„å­—æ®µæ–¹æ³•ä»¥é”®å€¼å¯¹çš„å½¢å¼å‘è®°å½•å™¨æ·»åŠ å…¶ä»–å±æ€§ã€‚ç„¶åï¼Œåœ¨å°†å¿…è¦çš„æ•°æ®æ·»åŠ åˆ°ä¸Šä¸‹æ–‡åï¼Œå¿…é¡»è°ƒç”¨è¯¥æ–¹æ³• Logger() ä»¥è¿”å›å…·æœ‰æ›´æ–°äº†ä¸Šä¸‹æ–‡çš„æ–° Logger å¯¹è±¡ï¼Œæ¯”å¦‚æ·»åŠ Timestamp()çš„Loggerå¯¹è±¡:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span>
		<span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	logger<span class="token punctuation">.</span>
		<span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">)</span>

	logger<span class="token punctuation">.</span>
		<span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lixin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T16:08:46+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;lixin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T16:08:46+08:00&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç æ®µå°†è¯¥<code>time</code>å­—æ®µæ·»åŠ åˆ°ç”Ÿæˆ<code>logger</code>çš„æ‰€æœ‰è®°å½•ä¸­ï¼Œå› ä¸ºæ‰€æœ‰æ—¥å¿—è®°å½•éƒ½åº”åŒ…å«æ—¶é—´æˆ³ã€‚ä½ è¿˜å¯ä»¥å°†æ–‡ä»¶å’Œè¡Œå·æ·»åŠ åˆ°æ‰€æœ‰æ—¥å¿—æ¡ç›®(æ·»åŠ Caller)ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span>
		<span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	logger<span class="token punctuation">.</span>
		<span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">)</span>

	logger<span class="token punctuation">.</span>
		<span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lixin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T16:12:21+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;caller&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;/Users/lixin/code/demo_zlog/main.go:19&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;lixin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T16:12:21+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;caller&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;/Users/lixin/code/demo_zlog/main.go:24&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆç”±äºæ–¹æ³•Logger()è¿”å›ä¸€ä¸ªå…¨æ–°çš„Loggerï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•With()å®ç°å­è®°å½•å™¨ï¼Œè¿™äº›è®°å½•å™¨ä½¿ç”¨ç›¸å…³å…ƒæ•°æ®æ³¨é‡Šç‰¹å®šèŒƒå›´å†…çš„æ‰€æœ‰æ—¥å¿—Loggerï¼Œä»¥å°†å®ƒä»¬ä¸å…¶ä»–è®°å½•åŒºåˆ†å¼€æ¥ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">var</span> logger <span class="token operator">=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Time</span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mainLogger <span class="token operator">:=</span> logger<span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	mainLogger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;main logger&quot;</span><span class="token punctuation">)</span>

	<span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	authLogger <span class="token operator">:=</span> logger<span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	authLogger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;auth logger&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	userLogger <span class="token operator">:=</span> logger<span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	userLogger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;user logger&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T16:18:58+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;main logger&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T16:18:58+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;auth&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;auth logger&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T16:18:58+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;user logger&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é™¤äº†<code>With</code>æ–¹å¼æ·»åŠ å±æ€§ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰<code>UpdateContext()</code>æ–¹æ³•:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>    logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">UpdateContext</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>c zerolog<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> zerolog<span class="token punctuation">.</span>Context <span class="token punctuation">{</span>
		<span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lixin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;info message&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;lixin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T16:22:05+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info message&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ç¾åŒ–ä½ çš„æ—¥å¿—ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ç¾åŒ–ä½ çš„æ—¥å¿—ä¿¡æ¯" aria-hidden="true">#</a> ç¾åŒ–ä½ çš„æ—¥å¿—ä¿¡æ¯</h2><p>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦ginæ¡†æ¶é‚£æ ·ç®€å•ç¾è§‚çš„æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ ·å°±å¯ä»¥è½»æ¾å‘ç°å„ç§å¼‚å¸¸äº‹ä»¶ï¼Œzerologæä¾›äº†ä¸€ä¸ªæ§åˆ¶å°ç¼–å†™å™¨ç±»å‹ï¼Œç”¨äºè§£æåŸå§‹JSONæ¡ç›®ï¼Œå¹¶å°†å…¶ä»¥å½©è‰²æ ¼å¼è¾“å‡ºã€‚</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>	buildInfo<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> debug<span class="token punctuation">.</span><span class="token function">ReadBuildInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	cpuProfile <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">NumCPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	numGoroutine <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">NumGoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>ConsoleWriter<span class="token punctuation">{</span>Out<span class="token punctuation">:</span> os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> TimeFormat<span class="token punctuation">:</span> time<span class="token punctuation">.</span>RFC1123<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Level</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>TraceLevel<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;pid&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">Getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;go_version&quot;</span><span class="token punctuation">,</span> buildInfo<span class="token punctuation">.</span>GoVersion<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;cpu_num&quot;</span><span class="token punctuation">,</span> cpuProfile<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;goroutine_num&quot;</span><span class="token punctuation">,</span> numGoroutine<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	logger<span class="token punctuation">.</span><span class="token function">Trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;trace message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;debug message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;info message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;warn message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;error message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">WithLevel</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>FatalLevel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;fatal message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">WithLevel</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>PanicLevel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;panic message&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>Mon<span class="token punctuation">,</span> <span class="token number">11</span> Sep <span class="token number">2023</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">:</span><span class="token number">35</span> CST TRC main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">28</span> <span class="token operator">&gt;</span> trace message cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">10562</span>
Mon<span class="token punctuation">,</span> <span class="token number">11</span> Sep <span class="token number">2023</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">:</span><span class="token number">35</span> CST DBG main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">29</span> <span class="token operator">&gt;</span> debug message cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">10562</span>
Mon<span class="token punctuation">,</span> <span class="token number">11</span> Sep <span class="token number">2023</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">:</span><span class="token number">35</span> CST INF main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">30</span> <span class="token operator">&gt;</span> info message cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">10562</span>
Mon<span class="token punctuation">,</span> <span class="token number">11</span> Sep <span class="token number">2023</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">:</span><span class="token number">35</span> CST WRN main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">31</span> <span class="token operator">&gt;</span> warn message cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">10562</span>
Mon<span class="token punctuation">,</span> <span class="token number">11</span> Sep <span class="token number">2023</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">:</span><span class="token number">35</span> CST ERR main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">32</span> <span class="token operator">&gt;</span> <span class="token builtin">error</span> message cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">10562</span>
Mon<span class="token punctuation">,</span> <span class="token number">11</span> Sep <span class="token number">2023</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">:</span><span class="token number">35</span> CST FTL main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">33</span> <span class="token operator">&gt;</span> fatal message cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">10562</span>
Mon<span class="token punctuation">,</span> <span class="token number">11</span> Sep <span class="token number">2023</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">:</span><span class="token number">35</span> CST PNC main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">34</span> <span class="token operator">&gt;</span> <span class="token builtin">panic</span> message cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">10562</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+v+`" alt="zlog1.png" tabindex="0" loading="lazy"><figcaption>zlog1.png</figcaption></figure><p>è¿˜å¯ä»¥ä½¿ç”¨ ConsoleWriter ç±»å‹ä¸Šæä¾›çš„é€‰é¡¹æ¥è‡ªå®šä¹‰è¾“å‡ºçš„å¤–è§‚å’Œæ ¼å¼ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>    buildInfo<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> debug<span class="token punctuation">.</span><span class="token function">ReadBuildInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	cpuProfile <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">NumCPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	numGoroutine <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">NumGoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>ConsoleWriter<span class="token punctuation">{</span>
		Out<span class="token punctuation">:</span>        os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span>
		TimeFormat<span class="token punctuation">:</span> time<span class="token punctuation">.</span>RFC3339<span class="token punctuation">,</span>
		FormatLevel<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;[%s]&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		FormatMessage<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;| %s |&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		FormatCaller<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> filepath<span class="token punctuation">.</span><span class="token function">Base</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		PartsExclude<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
			zerolog<span class="token punctuation">.</span>TimestampFieldName<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Level</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>TraceLevel<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;pid&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">Getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Str</span><span class="token punctuation">(</span><span class="token string">&quot;go_version&quot;</span><span class="token punctuation">,</span> buildInfo<span class="token punctuation">.</span>GoVersion<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;cpu_num&quot;</span><span class="token punctuation">,</span> cpuProfile<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;goroutine_num&quot;</span><span class="token punctuation">,</span> numGoroutine<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	logger<span class="token punctuation">.</span><span class="token function">Trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;trace message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;debug message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;info message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;warn message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;error message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">WithLevel</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>FatalLevel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;fatal message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">WithLevel</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>PanicLevel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;panic message&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">[</span>TRACE<span class="token punctuation">]</span> main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">46</span> <span class="token operator">|</span> trace message <span class="token operator">|</span> cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">11202</span>
<span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">47</span> <span class="token operator">|</span> debug message <span class="token operator">|</span> cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">11202</span>
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">48</span> <span class="token operator">|</span> info message <span class="token operator">|</span> cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">11202</span>
<span class="token punctuation">[</span>WARN<span class="token punctuation">]</span> main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">49</span> <span class="token operator">|</span> warn message <span class="token operator">|</span> cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">11202</span>
<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">50</span> <span class="token operator">|</span> <span class="token builtin">error</span> message <span class="token operator">|</span> cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">11202</span>
<span class="token punctuation">[</span>FATAL<span class="token punctuation">]</span> main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">51</span> <span class="token operator">|</span> fatal message <span class="token operator">|</span> cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">11202</span>
<span class="token punctuation">[</span>PANIC<span class="token punctuation">]</span> main<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">52</span> <span class="token operator">|</span> <span class="token builtin">panic</span> message <span class="token operator">|</span> cpu_num<span class="token operator">=</span><span class="token number">10</span> go_version<span class="token operator">=</span>go1<span class="token punctuation">.</span><span class="token number">19.12</span> goroutine_num<span class="token operator">=</span><span class="token number">1</span> pid<span class="token operator">=</span><span class="token number">11202</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+m+`" alt="zlog2.png" tabindex="0" loading="lazy"><figcaption>zlog2.png</figcaption></figure><p>ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œ ConsoleWriterä¼šå½±å“æ—¥å¿—è®°å½•é€Ÿåº¦ã€‚æä¾›å®ƒåªæ˜¯ä¸ºäº†å¸®åŠ©åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶æ›´æ˜“äºé˜…è¯»æ—¥å¿—ã€‚ä½ å¯ä»¥åˆ¤æ–­é…ç½®æ˜¯å¦æ˜¯å¼€å‘ç¯å¢ƒæ¥åˆ¤æ–­æ˜¯å¦å¯ç”¨ ConsoleWriter è¾“å‡ºï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">var</span> output io<span class="token punctuation">.</span>Writer <span class="token operator">=</span> zerolog<span class="token punctuation">.</span>ConsoleWriter<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">if</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;GO_ENV&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;development&quot;</span> <span class="token punctuation">{</span>
  output <span class="token operator">=</span> os<span class="token punctuation">.</span>Stderr
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="zerologçš„æµæ§é‡‡æ ·" tabindex="-1"><a class="header-anchor" href="#zerologçš„æµæ§é‡‡æ ·" aria-hidden="true">#</a> Zerologçš„æµæ§é‡‡æ ·</h2><p>é‡‡æ ·(Sampling)æ˜¯ä¸€ç§æ•…æ„æ”¾å¼ƒé‡å¤æ—¥å¿—æ¡ç›®çš„æŠ€æœ¯,è¿™æ ·åªä¿ç•™å¹¶å¤„ç†å…¶ä¸­çš„ä¸€éƒ¨åˆ†,è€Œä¸ç‰ºç‰²ä»æ—¥å¿—ä¿¡æ¯ã€‚è¿™å¯¹äºé«˜è®¿é—®é‡åº”ç”¨ç¨‹åºäº§ç”Ÿå¤§é‡è®°å½•å¾ˆæœ‰ç”¨,å¦‚æœä¿å­˜æ¯ä¸ªè®°å½•,åˆ™ä¼šå¯¼è‡´è¿‡åº¦çš„å­˜å‚¨å’Œå¤„ç†æˆæœ¬,è¿™å¯èƒ½ä¸æ˜¯ç†æƒ³çš„ã€‚é‡‡æ ·(Simpling)è§£å†³è¿™ä¸ªé—®é¢˜,é€šè¿‡é˜²æ­¢ç›¸åŒçš„æ—¥å¿—æ¯ç§’è®°å½•æ•°ç™¾æˆ–æ•°åƒæ¬¡,ä»è€Œé˜²æ­¢èµ„æºè¢«æ— å¿…è¦åœ°è€—å°½ã€‚å®ƒèƒ½é¿å…å› ä¿å­˜æ¯ä¸€æ¡é‡å¤æ—¥å¿—è€Œå¯¼è‡´çš„å­˜å‚¨å’Œè®¡ç®—æˆæœ¬è¿‡é«˜çš„é—®é¢˜ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ Zerolog å¯¹æ—¥å¿—è¿›è¡Œé‡‡æ ·çš„æœ€åŸºæœ¬æ–¹æ³•ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>    log <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">Sample</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>zerolog<span class="token punctuation">.</span>BasicSampler<span class="token punctuation">{</span>N<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msgf</span><span class="token punctuation">(</span><span class="token string">&quot;%d message :&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤é…ç½®çš„BasicSampler Loggerä½¿å¾—æ¯ä¸ªæ—¥å¿—åœ¨äº”æ¬¡ä¸­ä»…è®°å½•ä¸€æ¬¡ã€‚è¿™åœ¨forå¾ªç¯ä¸­æ¼”ç¤ºï¼Œå…¶ä¸­INFOæ¶ˆæ¯é€šå¸¸ä¼šè®°å½•åæ¬¡ï¼Œä½†ç”±äºé‡‡æ ·ï¼Œå®ƒåªè®°å½•ä¸¤æ¬¡ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:00:28+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;1 message&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:00:28+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;6 message&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Zerologæä¾›äº†å…¶ä»–æ›´å¤æ‚çš„é‡‡æ ·å™¨ã€‚ä¾‹å¦‚ï¼Œ BurstSampler å¯ç”¨äºé™åˆ¶åœ¨ä¸€å®šæ—¶é—´å†…è®°å½•çš„æ—¥å¿—æ•°ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>l <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Sample</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>zerolog<span class="token punctuation">.</span>BurstSampler<span class="token punctuation">{</span>
			Burst<span class="token punctuation">:</span>  <span class="token number">3</span><span class="token punctuation">,</span>
			Period<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">||</span> i <span class="token operator">==</span> <span class="token number">9</span> <span class="token punctuation">{</span>
			time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		l<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msgf</span><span class="token punctuation">(</span><span class="token string">&quot;a message from the gods: %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
		l<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msgf</span><span class="token punctuation">(</span><span class="token string">&quot;warn message: %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
		l<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msgf</span><span class="token punctuation">(</span><span class="token string">&quot;error message: %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œé…ç½® BurstSampler é™åˆ¶æ¯ç§’ Logger ç”Ÿæˆä¸‰ä¸ªçš„æ—¥å¿—ã€‚æœ¬æ¥ä¼šåœ¨æŒ‡å®šèŒƒå›´å†…è®°å½•çš„æ‰€æœ‰å…¶ä»–è®°å½•éƒ½å°†è¢«ä¸¢å¼ƒã€‚ä¸Šé¢çš„ for å¾ªç¯åº”è¯¥è®°å½• 30 æ¡æ¶ˆæ¯è€Œä¸è¿›è¡Œé‡‡æ ·ï¼Œä½†ç”±äºä¸Šé¢çš„é…ç½®ï¼Œå®ƒåªè®°å½•äº†9æ¡æ¶ˆæ¯ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:03:26+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;a message from the gods: 1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:03:26+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn message: 1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:03:26+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:03:27+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;a message from the gods: 5&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:03:27+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn message: 5&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:03:27+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 5&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:03:28+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;a message from the gods: 9&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:03:28+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn message: 9&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:03:28+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 9&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ è¿˜å¯ä»¥åªå°†é‡‡æ ·åº”ç”¨äºç‰¹å®šçº§åˆ«ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>   	burstSampler <span class="token operator">:=</span> <span class="token operator">&amp;</span>zerolog<span class="token punctuation">.</span>BurstSampler<span class="token punctuation">{</span>
		Burst<span class="token punctuation">:</span>  <span class="token number">3</span><span class="token punctuation">,</span>
		Period<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	l <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Sample</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>LevelSampler<span class="token punctuation">{</span>
			WarnSampler<span class="token punctuation">:</span> burstSampler<span class="token punctuation">,</span>
			InfoSampler<span class="token punctuation">:</span> burstSampler<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">||</span> i <span class="token operator">==</span> <span class="token number">9</span> <span class="token punctuation">{</span>
			time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		l<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msgf</span><span class="token punctuation">(</span><span class="token string">&quot;a message from the gods: %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
		l<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msgf</span><span class="token punctuation">(</span><span class="token string">&quot;warn message: %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
		l<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msgf</span><span class="token punctuation">(</span><span class="token string">&quot;error message: %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œå°†ä»…å¯¹ å’Œ WARN æ—¥å¿— INFO è¿›è¡Œé‡‡æ ·ï¼Œè€Œå…¶ä»–æ—¥å¿—å°†ç…§å¸¸è®°å½•ï¼Œä»è€Œç”Ÿæˆä»¥ä¸‹è¾“å‡ºï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:30+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;a message from the gods: 1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:30+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn message: 1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:30+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:30+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;a message from the gods: 2&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:30+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 2&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:30+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 3&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:30+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 4&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:31+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;a message from the gods: 5&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:31+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn message: 5&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:31+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 5&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:31+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;a message from the gods: 6&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:31+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 6&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:31+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 7&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:31+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 8&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:32+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;a message from the gods: 9&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:32+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;warn message: 9&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:32+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 9&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:32+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;a message from the gods: 10&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-23T21:07:32+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error message: 10&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="zerologé’©å­ğŸª" tabindex="-1"><a class="header-anchor" href="#zerologé’©å­ğŸª" aria-hidden="true">#</a> Zerologé’©å­ğŸª</h2><p>Zerolog æä¾›äº†ä¸€ç§é€šè¿‡ Hook æ¥å£æŒ‚æ¥åˆ°æ—¥å¿—è®°å½•è¿‡ç¨‹çš„æ–¹æ³•ï¼Œè¯¥æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> Hook <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// Run runs the hook with the event.</span>
    <span class="token function">Run</span><span class="token punctuation">(</span>e <span class="token operator">*</span>zerolog<span class="token punctuation">.</span>Event<span class="token punctuation">,</span> level zerolog<span class="token punctuation">.</span>Level<span class="token punctuation">,</span> message <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å…·ä½“ç±»å‹ä¸Šå®ç°Hookæ¥å£æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³• Logger.Hook()å°†å…¶åº”ç”¨äºLoggerä»¥ä¾¿åœ¨æ¯æ¬¡è®°å½•æ—¥å¿—æ—¶æ‰§è¡Œå…¶Run()æ–¹æ³•ã€‚ç„¶åï¼Œä½ å¯ä»¥æ ¹æ®äº‹ä»¶çš„æ—¥å¿—çº§åˆ«æˆ–å…¶ä»–ä¸€äº›æ¡ä»¶è¿è¡Œä¸åŒçš„æ“ä½œã€‚</p><p>æ¯”å¦‚ä½ å¯ä»¥è®°å½•ä¸€ä¸‹ç³»ç»Ÿå‘ç”Ÿ PANIC æ—¶ï¼Œå‘é€æŠ¥è­¦ä¿¡æ¯åˆ°Mixin/ä¼ä¸šå¾®ä¿¡ç­‰ã€‚</p><p>ä¸‹é¢æˆ‘æ¼”ç¤ºä¸€ä¸‹ï¼Œå½“æ—¥å¿—æ‰“å°PANICæ—¶ï¼ŒMixinæœºå™¨äººå°†å‘é€æŠ¥è­¦ä¿¡æ¯åˆ°æˆ‘çš„Mixinè´¦å·ä¸Š:</p>`,93)),s("div",h,[n[6]||(n[6]=s("p",{class:"hint-container-title"},"æç¤º",-1)),s("p",null,[s("a",w,[n[4]||(n[4]=a("Mixin")),t(o)]),n[5]||(n[5]=a("ç±»ä¼¼å¾®ä¿¡ï¼Œæˆ‘ä»¬æ“æ§Mixinæœºå™¨äººç±»ä¼¼äº,æ“æ§å°ç¨‹åºä¸€æ ·..."))])]),n[9]||(n[9]=e(`<p>ä¸‹é¢æ˜¯å°†è®°å½•å½“å‘ç”Ÿ FATAL çº§åˆ«çš„æ—¥å¿—æ—¶ï¼Œå°†å…·ä½“çš„æŠ¥è­¦ä¿¡æ¯å‘é€åˆ°æˆ‘çš„Mixinè´¦å·çš„ç¤ºä¾‹ï¼š</p><p>æˆ‘å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ç»“æ„:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>â”œâ”€â”€ config.json // å­˜æ”¾mixinæœºå™¨äººçš„é…ç½®ä¿¡æ¯
â”œâ”€â”€ go.mod 		
â”œâ”€â”€ go.sum	
â”œâ”€â”€ main.go		
â””â”€â”€ uid.txt		// æˆ‘è‡ªå·±è´¦å·çš„uid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// config.json åç»­æˆ‘ä¼šæ”¹æ‰</span>
<span class="token comment">// å¯ä»¥é€šè¿‡åœ¨mixinä¸Šæ³¨å†Œæœºå™¨äººè‡ªåŠ¨è·å¾—</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;client_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;30aad5a5-e5f3-4824-9409-c2ff4152724e&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;session_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;dc54f7c0-0640-49c3-aa4d-f5d3fe79c65c&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;private_key&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;VDdoIRQAuSqZwNq5wau6QlIU3EWZTkaUNhdxRlpe-VpZZgn-i24uaJcU5sNSGzcD9NjJS53TMYk0rsODVTQTUQ&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pin_token&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Szi3c7Dy7hVZAbnJN1NWAtNcDe6SS2aJd5NO-bYI5Xw&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;context&quot;</span>
	<span class="token string">&quot;encoding/base64&quot;</span>
	<span class="token string">&quot;encoding/json&quot;</span>
	<span class="token string">&quot;io/ioutil&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
	<span class="token string">&quot;time&quot;</span>

	<span class="token string">&quot;github.com/fox-one/mixin-sdk-go&quot;</span>
	<span class="token string">&quot;github.com/rs/zerolog&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
	logger   zerolog<span class="token punctuation">.</span>Logger
	MixinCli <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>mixin<span class="token punctuation">.</span>Client<span class="token punctuation">)</span>
	wg       sync<span class="token punctuation">.</span>WaitGroup
	uid      <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span><span class="token string">&quot;uid&quot;</span><span class="token punctuation">)</span>
	store    mixin<span class="token punctuation">.</span>Keystore
<span class="token punctuation">)</span>

<span class="token keyword">type</span> MixinPanicHook <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>MixinPanicHook<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span>
	e <span class="token operator">*</span>zerolog<span class="token punctuation">.</span>Event<span class="token punctuation">,</span>
	level zerolog<span class="token punctuation">.</span>Level<span class="token punctuation">,</span>
	message <span class="token builtin">string</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> level <span class="token operator">&gt;=</span> zerolog<span class="token punctuation">.</span>PanicLevel <span class="token punctuation">{</span>
		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token boolean">_</span> <span class="token operator">=</span> <span class="token function">notify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
			wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">notify</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token comment">// Send to Mixin / ä¼ä¸šå¾®ä¿¡ / Telegram</span>
	ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token function">SendPanicMsg</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	content<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">&quot;uid.txt&quot;</span><span class="token punctuation">)</span>
	uid <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
	logger <span class="token operator">=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Level</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>TraceLevel<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hook</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>MixinPanicHook<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	logger<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;error message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">WithLevel</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>FatalLevel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;fatal message&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">WithLevel</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>PanicLevel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;ç³»ç»Ÿå‘ç”Ÿäº†Panicæ¶ˆæ¯ğŸ˜­...&quot;</span><span class="token punctuation">)</span>

	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Open the keystore file</span>
	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;./config.json&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Panicln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Read the keystore file as json into mixin.Keystore, which is a go struct</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>store<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Panicln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	MixinCli<span class="token punctuation">,</span> err <span class="token operator">=</span> mixin<span class="token punctuation">.</span><span class="token function">NewFromKeystore</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>store<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		logger<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;init mixin client error.&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">SendPanicMsg</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> MixinCli<span class="token punctuation">.</span><span class="token function">SendMessage</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mixin<span class="token punctuation">.</span>MessageRequest<span class="token punctuation">{</span>
		MessageID<span class="token punctuation">:</span>      mixin<span class="token punctuation">.</span><span class="token function">RandomTraceID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		ConversationID<span class="token punctuation">:</span> mixin<span class="token punctuation">.</span><span class="token function">UniqueConversationID</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>ClientID<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">,</span>
		RecipientID<span class="token punctuation">:</span>    uid<span class="token punctuation">,</span>
		Category<span class="token punctuation">:</span>       mixin<span class="token punctuation">.</span>MessageCategoryPlainText<span class="token punctuation">,</span>
		Data<span class="token punctuation">:</span>           msg<span class="token punctuation">,</span>
		DataBase64<span class="token punctuation">:</span>     base64<span class="token punctuation">.</span>RawURLEncoding<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“è¿è¡Œä»¥ä¸Šmain.goç¨‹åºï¼Œå°±ä¼šç»™æˆ‘è‡ªå·±çš„mixinè´¦å·æŠ¥è­¦:</p><figure><img src="`+q+`" alt="zlog-mixin.png" tabindex="0" loading="lazy"><figcaption>zlog-mixin.png</figcaption></figure><p>ä¸Šé¢çš„ç¨‹åºåˆ›å»ºäº†ä¸€ä¸ª MixinPanicHook å®ç°æ¥å£çš„ç±»å‹ zerolog.Hookã€‚å®ƒçš„æ–¹æ³•æ£€æŸ¥æ­£åœ¨è®°å½•çš„æ¶ˆæ¯çš„çº§åˆ«ï¼Œå¦‚æœå®ƒRun()çš„çº§åˆ«å’Œ PANIC ä¸€æ ·ä¸¥é‡ï¼Œåˆ™å°†å…¶å‘é€åˆ°æˆ‘çš„mixinè´¦å·ã€‚å¦‚æœä½ è¿è¡Œè¯¥ç¨‹åºï¼Œä½ è¿˜è§‚å¯Ÿåˆ°æ¯æ¡æ—¥å¿—æ¶ˆæ¯éƒ½æ‰“å°åˆ°æ§åˆ¶å°ã€‚</p><h2 id="zerologé”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#zerologé”™è¯¯å¤„ç†" aria-hidden="true">#</a> Zerologé”™è¯¯å¤„ç†</h2><p>é”™è¯¯å¤„ç†æ˜¯ç¡®ä¿å¿«é€Ÿæ£€æµ‹å’Œä¿®å¤é”™è¯¯çš„æœ€é‡è¦çš„äº‹æƒ…ä¹‹ä¸€ï¼Œå› æ­¤æ—¥å¿—è®°å½•æ¡†æ¶å¿…é¡»é…å¤‡é½å…¨æ‰èƒ½ä»¤äººæ»¡æ„åœ°æ‰§è¡Œæ­¤æ“ä½œã€‚Zerologæä¾›äº†ä¸€äº›å¸®åŠ©ç¨‹åºæ¥è®°å½•é”™è¯¯ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬èŠ‚ä¸­æ¼”ç¤ºè¿™äº›ç¨‹åºã€‚</p><p>ä½¿ç”¨Zerologè®°å½•é”™è¯¯çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨ERRORçº§åˆ«è®°å½•å¹¶åœ¨Err()ç”Ÿæˆçš„zerolog.Event, è¿™ä¼šå‘æ—¥å¿—æ¡ç›®æ·»åŠ ä¸€ä¸ª error å±æ€§ï¼Œå…¶ä¸­åŒ…å«ç›¸å…³é”™è¯¯çš„è¯¦ç»†ä¿¡æ¯ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">Err</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;err happened&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;err happened&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:25:44+08:00&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½ å¯ä»¥é€šè¿‡æ›´æ”¹ä»¥ä¸‹ zerolog.ErrorFieldName å€¼å°†é”™è¯¯çš„å­—æ®µåç§°æ›´æ”¹ä¸ºå…¶ä»–å€¼ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>zerolog<span class="token punctuation">.</span>ErrorFieldName <span class="token operator">=</span> <span class="token string">&quot;é”™è¯¯ä¿¡æ¯&quot;</span>
logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">Err</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;err happened&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;é”™è¯¯ä¿¡æ¯&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;err happened&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:26:40+08:00&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è™½ç„¶ä¸Šé¢çš„è¾“å‡ºæä¾›äº†æœ‰å…³æ‰€å‘ç”Ÿé”™è¯¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†å®ƒæ²¡æœ‰æ˜¾ç¤ºå¯¼è‡´é”™è¯¯çš„ä»£ç æ‰§è¡Œè·¯å¾„ï¼Œè¿™å¯¹äºè°ƒè¯•é—®é¢˜è‡³å…³é‡è¦ã€‚ä½ å¯ä»¥é€šè¿‡ Event ä¸Š Stack() çš„æ–¹æ³•åœ¨é”™è¯¯æ—¥å¿—ä¸­åŒ…å«å †æ ˆè·Ÿè¸ªæ¥è§£å†³æ­¤é—®é¢˜ï¼Œä½†åœ¨å®ƒç”Ÿæ•ˆä¹‹å‰ï¼Œå¿…é¡»åˆ†é…ç»™ zerolog.ErrorStackMarshaler å¯ä»¥ä»é”™è¯¯ä¸­æå–å †æ ˆè·Ÿè¸ªçš„å‡½æ•°ã€‚ä½ å¯ä»¥å°† pkg/errors ä¸ zerolog/pkgerrors å¸®åŠ©ç¨‹åºç»“åˆä½¿ç”¨ï¼Œä»¥å°†å †æ ˆè·Ÿè¸ªæ·»åŠ åˆ°é”™è¯¯æ—¥å¿—ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/pkg/errors&quot;</span>
	<span class="token string">&quot;github.com/rs/zerolog/pkgerrors&quot;</span>

	<span class="token string">&quot;github.com/rs/zerolog&quot;</span>
	<span class="token string">&quot;github.com/rs/zerolog/log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	zerolog<span class="token punctuation">.</span>ErrorStackMarshaler <span class="token operator">=</span> pkgerrors<span class="token punctuation">.</span>MarshalStack
	log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;seems we have an error here&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;stack&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;func&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;line&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;14&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;main.go&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;func&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;line&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;250&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;proc.go&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;func&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;goexit&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;line&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;1172&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;asm_arm64.s&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;seems we have an error here&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:54:28+08:00&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">æ³¨æ„</p><p>æ³¨æ„è¿™é‡Œå¼•å…¥çš„åŒ…æ˜¯<code>&quot;github.com/pkg/errors&quot;</code>ä¸æ˜¯<code>&quot;errors&quot;</code>,è¿™é‡Œæ˜¯ä¸ªå‘ã€‚</p></div><p>è¿˜å¯ä»¥ä½¿ç”¨FATALæˆ–è€…PANICçº§åˆ«è®°å½•åº”ç”¨ç¨‹åºæ— æ³•æ¢å¤çš„ç‰¹åˆ«ä¸¥é‡çš„é”™è¯¯ã€‚æ³¨æ„ï¼Œåœ¨FATALçº§åˆ«è®°å½•ä¼šå¯¼è‡´ç¨‹åºç«‹å³é€€å‡ºï¼ŒPANIC çº§åˆ«åœ¨è®°å½•æ¶ˆæ¯åå°†è°ƒç”¨panic()ã€‚</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>    logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	err <span class="token operator">:=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;failed to connect to database&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;something fatal happened!&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡º</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;fatal&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;failed to connect to database&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:43:26+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;something fatal happened!&quot;</span><span class="token punctuation">}</span>
exit status <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦åœ¨ä¸åˆ†åˆ«è°ƒç”¨ os.Exit(1) å’Œ panic() çš„æƒ…å†µä¸‹è®°å½• FATAL æˆ– PANIC çº§åˆ«æ¶ˆæ¯ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤º WithLevel() çš„æ–¹æ³•ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>    logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	err <span class="token operator">:=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;failed to connect to database&quot;</span><span class="token punctuation">)</span>
	logger<span class="token punctuation">.</span><span class="token function">WithLevel</span><span class="token punctuation">(</span>zerolog<span class="token punctuation">.</span>FatalLevel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;something fatal happened!&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¨‹åºä¸ä¼šç«‹å³é€€å‡ºï¼Œä½†ä»ä¼šåœ¨é€‚å½“çš„çº§åˆ«è®°å½•äº‹ä»¶ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;fatal&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;failed to connect to database&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:44:25+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;something fatal happened!&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="æŒä¹…åŒ–æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#æŒä¹…åŒ–æ—¥å¿—" aria-hidden="true">#</a> æŒä¹…åŒ–æ—¥å¿—</h2><p>ä½¿ç”¨ Zerolog å­˜å…¥æ–‡ä»¶çš„é€‰é¡¹ä¸ä½¿ç”¨æ ‡å‡†åº“æ—¥å¿—åŒ…æ—¶å‡ ä¹ç›¸åŒã€‚ç”±äºå¯ä»¥å°† io.Writer å®ç°æ¥å£çš„ç±»å‹ä¼ é€’ç»™ zerolog.New() æ–¹æ³•ï¼Œå› æ­¤åªè¦ä½¿ç”¨é€‚å½“çš„æƒé™æ‰“å¼€æ–‡ä»¶ï¼Œä»»ä½• os.File å®ä¾‹éƒ½å°†æŒ‰é¢„æœŸå·¥ä½œã€‚</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;os&quot;</span>

	<span class="token string">&quot;github.com/rs/zerolog&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span>
		<span class="token string">&quot;zlog.log&quot;</span><span class="token punctuation">,</span>
		os<span class="token punctuation">.</span>O_APPEND<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_WRONLY<span class="token punctuation">,</span>
		<span class="token number">0664</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	logger <span class="token operator">:=</span> zerolog<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Msg</span><span class="token punctuation">(</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹æ—¥å¿—:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>âœ  demo_zlog <span class="token keyword">go</span> run main<span class="token punctuation">.</span><span class="token keyword">go</span>
âœ  demo_zlog cat zlog<span class="token punctuation">.</span>log   
<span class="token punctuation">{</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2023-09-11T17:45:51+08:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Info message&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ginæ¡†æ¶ä¸­zerologçš„åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#ginæ¡†æ¶ä¸­zerologçš„åº”ç”¨" aria-hidden="true">#</a> Ginæ¡†æ¶ä¸­zerologçš„åº”ç”¨</h2>`,37)),s("p",null,[t(i,{to:"/posts/program/golang/%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6%E5%B7%A5%E5%85%B7/gin/gin-use-zerolog.html"},{default:g(()=>n[7]||(n[7]=[a("ginæ¡†æ¶ä¸­ä½¿ç”¨zerologæ—¥å¿—åº“")])),_:1})])])}const y=l(b,[["render",x],["__file","zerolog.html.vue"]]);export{y as default};
