---
icon: cryptocurrency:aave
date: 2025-02-27
isOriginal: true
category:
  - notes
tag:
  - crypto
  - lend
  - swap
---

本系列会介绍常见的借贷协议例如 EVM 系的 AAVE、Morpho，SVM 系的 Marginfi、Solend等，会列举出他们的一些常见行为，以及不同之处，最后还会给出一些收益不错(APY>12%)的套利行为

<!-- more -->

# Defi乐高之借贷协议(1)

## 概念介绍

最近对借贷协议非常感兴趣，所以去各个借贷协议上去玩了玩，读了读这些协议的文档做了一些Research，觉得有必要将学习到的常见借贷协议机制给总结下来，不然也不好意思说自己懂DeFi喜欢玩套利。

相同之处，所有的借贷协议都一定有五种行为：Lend(存款)、Borrow(借款)、Withdraw(提现)、Repay(偿还)、Liquidate(清算)，一般协议还支持闪贷等，下面讲解一下基础的概念。

### 1. Lend (存款)

用户将资产存入借贷池中，获得对应的凭证代币(也可能不会)，可以赚取存款利息，存入的资产会成为借贷池的流动性，一般情况借贷协议会根据借贷池被借用的比例动态设置利率，避免池子里的钱都被借走导致存款人无法Withdraw。

### 2. Borrow (借款)

用户需要通过Lend行为先存入抵押品，根据资产抵押率计算可借额度，不同资产的抵押率不同(例如稳定币通常在 75%-100%, 波动币种在 50%-75%,一些流动性较低的资产抵押率是0%)，在借款后偿还时需要支付借款利息，需要注意维持健康因子(Health Factor)以避免清算

### 3. Withdraw (提现)

用户可以随时提取存入的资产，需要确保有足够的流动性，如果资产被借出,可能需要等待或只能提取部分，提现会销毁对应的凭证代币(也可能没有凭证代币)

### 4. Repay (偿还)

偿还借出的资产本金和利息，可以选择部分偿还或全部偿还，偿还后会释放对应的抵押品额度，一些协议支持使用不同代币偿还(通常是从其他协议Swap交易获得需要偿还的代币)

### 5. Liquidate (清算)

当用户的健康因子低于阈值时触发(通常是 1)清算人可以购买被清算用户的抵押品，清算人通常可以获得一定折扣(例如 5%-10%)，清算机制保护协议的安全性，不同协议的清算触发条件和奖励机制可能不同

### 6. Flash Loan(闪电贷)

一些协议特有的功能，在同一个区块内完成借贷和还款(做多做空)，不需要抵押品，主要用于套利、清算等场景，需要支付手续费。

闪贷套利(在一个区块中完成的操作)：

```
DEX价差套利
1. 从AAVE闪贷借出1000 USDC
2. 在DEX-A以1980 USDC买入1个ETH
3. 在DEX-B以2000 USDC卖出1个ETH
4. 偿还1000 USDC + 0.9 USDC(手续费)
5. 净利润约19.1 USDC

清算套利
1. 发现某用户健康因子接近1
2. 闪贷借出足够资金
3. 执行清算获得折扣资产(5-10%折扣)
4. 在市场上卖出获得的资产
5. 偿还闪贷
6. 获得清算利润

借贷利率套利
1. 从AAVE闪贷借出10000 USDC
2. 在Compound存入获得8%年化
3. 在Compound借出ETH获得12%年化
4. 在AAVE存入ETH获得15%年化
5. 偿还闪贷本金和手续费
6. 赚取利率差价
```

### 7. Health Factor(健康因子)
健康因子是账户的健康度,通常是存款/借款的比例。

例子:我存入了`$100K`美金的BTC，BTC的抵押率是50%，那么我可以借出 `$50k`其他资产，如果我借出 `$10k` 的USDT，那么我的健康度的计算方式就是: `$100k x 50% / $10k = 5`,那么我的健康因子就是安全的，不会被清算，此时如果 `BTC暴跌或者USDT暴涨，那么当健康因子<1时就会被清算，清算时我们的本金可能会以市场折扣价被收购比如清算人会用 $1k BTC帮助我们偿还 $800 USDT的借款，我们需要避免这种情况的发生`。

> 健康因子的计算方式各个协议可能不同，但是基本思路类似。

### 8. 预言机 (Oracle)

链上的代币价格通常由预言机提供(如果预言机被攻击则几乎所有DeFi协议都会有风险)，大多数借贷协议使用 Chainlink、Pyth 等知名预言机服务，这些预言机通过去中心化的方式聚合多个数据源的价格信息，以确保价格数据的准确性和可靠性。一些协议也会使用自己的预言机系统或多个预言机的组合来增强安全性。

### 9. 利率模型

借贷协议通常采用动态利率模型，根据资金池的使用率自动调整存借利率：

- 利用率 = 已借出金额 / 总存款金额
- 当利用率较低时，借款利率较低以刺激贷款
- 当利用率较高时，借款利率快速上升以维持流动性
- 存款利率通常是借款利率的一定比例(如 50%-70%),中间的差价一般由项目方/Pool Creater 获取

不同协议的具体利率计算公式可能不同，但都遵循"利用率越高，利率越高"的基本原则，避免借贷池枯竭。

> 下一个章节将详细讲解AAVE协议在这些方面的具体含义，并且会附加一些合约代码进行讲解。

> 分享一下我最近在Sui链上有个U本位14%左右的年化套利(不构成投资建议,不懂就不要参与):

在 [scallop](https://www.scallop.io/) 抵押 USDC 获得sUSDC, 去 [Bucket](https://www.bucketprotocol.io/),抵押 sUSDC 铸造 Bucket代币,再重新质押 Bucket 最终的 U 本位收益是: (5.65 + 15.5 - 6.62) ≈ 14.5%

> SUI本位 20% 左右的年化:

去 NAVI 上质押 Sui 获取 vSui,再抵押 vSUI 去借Sui,重复流程,最终可以到 20% 左右的 SUI 本位年化
